<h1><%= @goal.title %></h1>

<p>This goal is owned by <%= @user.username %>.</p>
<a href="<%= user_url(@user) %>">See all of <%= @user.username %>'s goals</a>

<% unless @goal.description == '' %>
    <h2>Description</h2>
    <p><%= @goal.description %></p>
<% end %>

<% if @goal.due_date %>
    <h2>Due date</h2>
    <p><%= @goal.due_date %></p>
<% end %>

<p>This goal is <%= @goal.privacy.downcase %>.</p>

<% if @goal.completion == 'Not completed' %>
    <p>This goal has not been completed.</p>
<% else %>
    <p>This goal has been completed!</p>
<% end %>

<% if current_user == @user %>

    <% if @goal.completion == 'Not completed' %>
        <form action="<%= goal_url(@goal) %>" method="post">
            <%= insert_form_authenticity_token %>
            <input type="hidden" name="_method" value="patch">
            <input type="hidden" name="goal[completion]" value="Completed">

            <input type="submit" value="Mark goal as completed">
        </form>

    <br>
    <% end %>

    <form action="<%= edit_goal_url(@goal) %>" method="get">
        <input type="submit" value="Edit goal">
    </form>

    <br>

    <form action="<%= goal_url(@goal) %>" method="post">
        <%= insert_form_authenticity_token %>
        <input type="hidden" name="_method" value="delete">

        <input type="submit" value="Delete goal">
    </form>
<% end %>

<% comments_to_display = @goal.comments.includes(:author) %>
<h2><%= comments_to_display.empty? ? "" : "Comments" %></h2>
<% comments_to_display.each do |comment| %>
    <blockquote>
        <p><%= comment.comment_text %></p>
        <footer>-<%= comment.author.username %></footer>
    </blockquote>
<% end %>

<%= render 'shared/error_messages' %>

<% if logged_in? %>
    <form action="<%= comments_url %>" method="post">
        <%= insert_form_authenticity_token %>
        <input
            type="hidden"
            name="comment[commentable_id]"
            value="<%= @goal.id %>">
        <input
            type="hidden"
            name="comment[commentable_type]"
            value="Goal">
        <input
            type="hidden"
            name="comment[author_id]"
            value="<%= current_user.id %>">

        <label for="comment_text">Add a new comment:</label>
        <textarea name="comment[comment_text]" id="comment_text" cols="30" rows="10"></textarea>

        <br>

        <input type="submit" value="Submit comment">
    </form>
<% end %>